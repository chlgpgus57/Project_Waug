<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="goodsMapper">

<select id="getCityName" parameterType="Integer" resultType="String">
	select city_name from nationinfo where city_num=#{city_num}
</select>

<select id="maxGoodsNum" resultType="Integer">
select max(goods_num) from goods
</select>

<insert id="infoInsert" parameterType="InfoVO">
		<selectKey order="BEFORE" resultType="Integer" keyColumn="goods_num">
			select max(goods_num) from goods
		</selectKey>
	insert into info values(#{goods_num},#{delivery_time},#{duration},#{language},#{boucher},#{cancel},#{using_time},#{pick_up},#{people})
</insert>

<select id="selectGoodsInfo" resultType="InfoVO" parameterType="Integer">
	select * from info where goods_num=#{goods_num}
</select>
<!-- 12.12 updat -->
<insert id="goodsInsert" parameterType="GoodsVO">
	
	insert into goods values(goods_seq.nextval, #{price}, #{discount}, #{coupon},
	#{location},#{able},#{city_num},#{o_num},#{qtt},#{title},#{t_num},#{img},0,#{cate_num},
	#{program},#{charming},#{included},#{not_included},#{how_to_use},#{remember},#{cancel},#{img1},#{img2},#{img3},#{img4})
</insert>
<!-- 12.11 updat******************************************* -->


	<sql id="bs">
		<choose>
			<when test="kind == 'good'">
				where title like '%'||#{search}||'%'
			</when>
			<when test="kind == 'city'">
				where city_name like '%'||#{search}||'%'
			</when>
			<when test="kind == 'theme'">
				where t_title like '%'||#{search}||'%'
			</when>
			<when test="kind == 'cate_name'">
				where cate_name like '%'||#{search}||'%'
			</when>
		</choose>
	</sql>

	<!-- 추천도시 -->
  <select id="areaRecomand" resultType="NationVO">
  	select * from nationinfo where city_rec = 1
  </select>
  <!-- 유럽도시 -->
  <select id="europeList" resultType="NationVO">
  	select * from nationinfo where continents='유럽'
  </select>
  <!-- 아시아도시 -->
  <select id="asiaList" resultType="NationVO">
  	select * from nationinfo where continents like '%아시아'
  </select>
  
  <select id="areaSelect" parameterType="NationVO" resultType="NationVO">
  	select * from nationinfo where city_num=#{city_num}
  </select>
  
  <select id="goodsList" parameterType="Pager" resultType="GoodsVO">
  	select * from
	(select N.*, rownum R from
	(select * from
	(select A.*, B.city_name city_name, C.t_title t_title,  D.cate_name cate_name from goods A, nationinfo B, theme C, category D
		where A.city_num = B.city_num and A.t_num = C.t_num and A.cate_num = D.cate_num) <include refid="bs"></include> order by goods_num desc) N)
        where R between #{startRow} and #{lastRow}
  </select>

	
	<select id="goodsCount" resultType="Integer" parameterType="Pager">
		select count(goods_num) from
		(select A.*, B.city_name city_name, C.t_title t_title, D.cate_name cate_name from goods A, nationinfo B, theme C, category D
		where A.city_num = B.city_num and A.t_num = C.t_num and A.cate_num = D.cate_num)
		<include refid="bs"></include>
		
	</select>
	
  <select id="goodsRecomand" parameterType="MemberVO"  resultType="GoodsVO">
  	select goods_num,price,discount,coupon,location,able,city_num,o_num,qtt, title,t_num,img,1 wish,cate_num
		from goods 
		where goods_num in(select goods_num from wishlist where email=#{m_pk})
	union
	select goods_num,price,discount,coupon,location,able,city_num,o_num,qtt, title,t_num,img, wish, cate_num
		from goods
		where goods_num not in(select goods_num from wishlist where email=#{m_pk})
  </select>

  <select id="goodsSelectOne" resultType="GoodsVO" parameterType="Integer">
  	select * from goods where goods_num=#{goods_num}
  </select>

  
  <!-- 도시리스트 -->
  <select id="cityList" resultType="NationVO">
  	select * from nationinfo
  </select>
  
  <!-- 테마리스트 -->
  <select id="themeList" resultType="ThemeVO">
  	select * from theme
  </select>
  <!-- 옵션리스트 -->
  <select id="optionList">
  </select>
  <!-- 카테고리리스트 -->
  <select id="cateList" resultType="CategoryVO">
  	select * from category
  </select>
</mapper>